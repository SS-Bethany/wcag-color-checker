<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WCAG AA Contrast Checker (Single Input)</title>
    <style>
        /* --- CSS Styling --- */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h1 {
            color: #007bff;
            text-align: center;
        }
        h2 {
            margin-top: 30px;
            padding-bottom: 5px;
            border-bottom: 2px solid #ddd;
            color: #333;
        }
        #input-section {
            display: flex;
            flex-direction: column; /* Changed to column for vertical stacking */
            align-items: center;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 600px; /* Constrain width for cleaner look */
            margin: 0 auto;
        }
        /* New Textarea Style */
        #color-input {
            padding: 10px;
            margin: 10px 0 15px 0;
            border: 2px solid #ccc;
            font-size: 16px;
            width: 100%;
            min-height: 100px;
            box-sizing: border-box;
            resize: vertical;
            font-family: monospace;
        }
        button {
            padding: 10px 20px;
            background-color: #28a745; 
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 4px;
        }
        /* New Swatch Area Style */
        #color-swatches {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
        }
        .color-swatch {
            width: 30px;
            height: 30px;
            margin: 5px;
            border: 2px solid #333;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            text-align: center;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #e9ecef;
            font-weight: bold;
            color: #333;
        }
        
        /* --- Pass/Fail Styling (HIGH PRIORITY) --- */
        td.pass {
            background-color: #d4edda !important; 
            color: #155724 !important; 
            font-weight: bold;
            border: 2px solid #c3e6cb;
        }
        td.fail {
            background-color: #f8d7da !important; 
            color: #721c24 !important; 
            font-weight: bold;
            border: 2px solid #f5c6cb;
        }
        td:nth-child(3) { 
            background-color: #f7f7f7;
        }
        #white-contrast-results td:first-child,
        #all-pairings-results td:first-child,
        #all-pairings-results td:nth-child(2) {
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>SmartSites Custom WCAGG Contrast Checker</h1>
    <p style="text-align: center; margin-bottom: 30px;">
        Table 1 shows **all** results against white. Table 2 shows **only** color pairings that **PASS** WCAG AA (Contrast Ratio â‰¥ 4.5:1).
    </p>

    <div id="input-section">
        <label for="color-input" style="width: 100%; text-align: center; font-weight: bold;">Enter Hex Codes (separated by spaces, commas, or newlines):</label>
        <textarea id="color-input" 
            placeholder="#00539C #FFFFFF #FFC000 #333333 #F0F0F0" 
            rows="5">#00539C #FFFFFF #FFC000 #333333 #F0F0F0</textarea>
        
        <div id="color-swatches"></div>

        <button onclick="checkContrast()">Check Contrast</button>
    </div>

    <hr>

    <h2>1. AA Pass/Fail Check Against White (#FFFFFF) - Shows ALL Results</h2>
    <table id="white-contrast-results">
        <thead>
            <tr>
                <th>Foreground (Text)</th>
                <th>Background</th>
                <th>Ratio</th>
                <th>AA Pass/Fail (4.5:1)</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <hr>

    <h2>2. Color Pairings that PASS AA against each other - Shows ONLY Passing Results</h2>
    <p>Displays pairs (Foreground/Text against Background) that achieve a ratio of 4.5:1 or higher.</p>
    <table id="all-pairings-results">
        <thead>
            <tr>
                <th>Foreground (Text)</th>
                <th>Background</th>
                <th>Ratio</th>
                <th>AA Pass/Fail (4.5:1)</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <script>
        // --- Core WCAG Calculation Functions ---
        function hexToRgb(hex) {
            let cleanHex = hex.trim().toUpperCase().replace(/^#/, '');

            if (cleanHex.length === 3) {
                cleanHex = cleanHex.split('').map(char => char + char).join('');
            }
            
            if (cleanHex.length !== 6) {
                return [0, 0, 0]; 
            }

            const r = parseInt(cleanHex.substring(0, 2), 16);
            const g = parseInt(cleanHex.substring(2, 4), 16);
            const b = parseInt(cleanHex.substring(4, 6), 16);
            
            return [r, g, b];
        }

        function getLuminance(rgb) {
            const a = rgb.map(v => {
                v /= 255;
                return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
        }

        function getContrastRatio(l1, l2) {
            const lighter = Math.max(l1, l2);
            const darker = Math.min(l1, l2);
            return (lighter + 0.05) / (darker + 0.05);
        }

        const WCAG_AA_NORMAL = 4.5;

        function checkWCAG_AA(ratio) {
            return ratio >= WCAG_AA_NORMAL;
        }
        
        // Helper to convert RGB back to Hex (used for consistent display)
        function rgbToHex([r, g, b]) {
            const toHex = c => {
                const hex = c.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            };
            return `${toHex(r)}${toHex(g)}${toHex(b)}`.toUpperCase();
        }

        // --- Core Application Functions ---
        
        // NEW FUNCTION: Updates the visual swatches below the textarea
        function updateSwatches(hexCodes) {
            const swatchesDiv = document.getElementById('color-swatches');
            swatchesDiv.innerHTML = ''; // Clear previous swatches
            
            hexCodes.forEach(hex => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = hex;
                swatchesDiv.appendChild(swatch);
            });
        }

        function createResultRow_AA(foregroundHex, backgroundHex, ratio) {
            const passesAA = checkWCAG_AA(ratio); 
            const ratioStr = ratio.toFixed(2);
            
            const getResultCell = (pass) => `<td class="${pass ? 'pass' : 'fail'}">${pass ? 'ðŸŸ¢ PASS' : 'ðŸ”´ FAIL'}</td>`;
            const fgLuminance = getLuminance(hexToRgb(foregroundHex));

            let html = `
                <tr>
                    <td style="background-color: ${foregroundHex}; border: 1px solid #ccc; color: ${fgLuminance > 0.179 ? '#000000' : '#FFFFFF'};">${foregroundHex}</td>
                    <td style="background-color: ${backgroundHex}; border: 1px solid #ccc; color: ${getLuminance(hexToRgb(backgroundHex)) > 0.179 ? '#000000' : '#FFFFFF'};">${backgroundHex}</td>
                    <td>${ratioStr}:1</td>
                    ${getResultCell(passesAA)}
                </tr>
            `;
            return html;
        }

        function checkAgainstWhite(hexCodes) {
            const WHITE_HEX = "#FFFFFF";
            const WHITE_LUMINANCE = 1.0; 
            const resultsTable = document.querySelector('#white-contrast-results tbody');
            resultsTable.innerHTML = ''; 
            
            let html = '';
            
            hexCodes.forEach(fgHex => {
                const fgL = getLuminance(hexToRgb(fgHex));
                const ratio = getContrastRatio(WHITE_LUMINANCE, fgL);
                
                html += createResultRow_AA(fgHex, WHITE_HEX, ratio);
            });

            resultsTable.innerHTML = html;
        }

        function checkAllPairings(hexCodes) {
            const resultsTable = document.querySelector('#all-pairings-results tbody');
            resultsTable.innerHTML = ''; 

            let html = '';
            let passesFound = 0;
            
            for (let i = 0; i < hexCodes.length; i++) {
                for (let j = 0; j < hexCodes.length; j++) {
                    if (i === j) continue;
                    
                    const fgHex = hexCodes[i]; 
                    const bgHex = hexCodes[j]; 

                    const fgL = getLuminance(hexToRgb(fgHex));
                    const bgL = getLuminance(hexToRgb(bgHex));
                    
                    const ratio = getContrastRatio(fgL, bgL);
                    
                    if (checkWCAG_AA(ratio)) {
                         html += createResultRow_AA(fgHex, bgHex, ratio);
                         passesFound++;
                    }
                }
            }

            if (passesFound === 0) {
                 resultsTable.innerHTML = '<tr><td colspan="4" class="fail">No pairings passed AA contrast.</td></tr>';
            } else {
                 resultsTable.innerHTML = html;
            }
        }
        
        /**
         * Main function triggered by the button click and on page load.
         */
        function checkContrast() {
            const inputElement = document.getElementById('color-input');
            const rawInput = inputElement.value.trim().toUpperCase();
            
            // Regex to find 6 hex digits, optionally preceded by a #
            const hexCodeRegex = /#?([0-9A-F]{6})/g;
            const matches = [...rawInput.matchAll(hexCodeRegex)];
            
            const hexCodes = matches.map(match => {
                const rgb = hexToRgb(match[0]);
                // Re-format to #RRGGBB using the robust conversion
                return `#${rgbToHex(rgb)}`;
            });

            if (hexCodes.length === 0) {
                alert("Please enter at least one valid 6-digit hex code.");
                // Clear tables and swatches if no codes are found
                document.querySelector('#white-contrast-results tbody').innerHTML = '';
                document.querySelector('#all-pairings-results tbody').innerHTML = '';
                updateSwatches([]);
                return;
            }
            
            // Update the visual swatches
            updateSwatches(hexCodes);

            // Execute the checks
            checkAgainstWhite(hexCodes);
            checkAllPairings(hexCodes);
        }

        // Initial check on load with default colors
        document.addEventListener('DOMContentLoaded', checkContrast);
    </script>
</body>
</html>